## Transaction Plans in RTA

### What are Transaction Plans?

Transaction plans are used to generate orders on a recurring basis.
The user can use the transaction plan APIs to create two types of plans - systematic plans (SIP/ SWP/ STP) or non-systematic plans.

### What is a Non-Systematic Plan?
A non-systematic plan has the same behaviour as that of a systematic plan, but is not registered as a systematic plan in RTA. Instead it is registered as a series of lumpsum orders generated at the frequency specified by the user during the non-systematic plan creation.

> A non-systematic plan can be created by creating a transaction plan with `systematic` = false.


### Transaction Plan Lifecycle
<div>
  <img src="../../images/transaction-plans-workflow.png">
</div>

<br>
1. User creates a transaction plan. The plan immediately becomes `active` upon plan creation. 
2. Once the plan becomes active, FP takes the responsibility of creating installments as per the `installment_day` and `frequency` of the plan. Refer [Installment Generation Lifecycle](#installment-generation-lifecycle) section below to understand the flow of installments.
3. The user can choose to [cancel](#api-references) an active plan. If this is done, the plan state changes to `cancelled` immediately. <br> Once a plan is `cancelled`, FP no longer generates installments for the plan.
4. Once all the installments of the plan have been generated, the plan state changes to `completed`.'
5. The user can also choose to modify an active plan. Please refer [Transaction Plan Modifications](#transaction-plan-modifications) for more info.

### Transaction Plan Modifications
1. After the plan is active, the user has the option to [modify the plan](#api-references) as per his requirement -
   - If the plan is systematic (`systematic` = true), the user can modify the plan amount.
   - If the plan is non-systematic (`systematic` = false), the user can modify the plan amount, installment day and number of installments. 
2. The user can also opt to [pause a plan](#api-references) between a given timeframe. Upon pausing the plan, for all the installments that fall under the time frame, FP generates the installments and marks them as `cancelled`. 

> If a user wants to modify a plan right from the next installment, the plan must be modified at least 2 days before the next installment is scheduled.

### Installment Generation Lifecycle
For every installment of a plan, FP creates a MF order. 
To understand more about the installment lifecycle please refer [Orders Lifecycle](https://docs.fintechprimitives.com/mf-transactions/orders-lifecycle)

### Example Use Cases

##### John is expecting a 40% increment in 2023 and wants to increase the Axis Emerging fund SIP from 5,000 to 10,000. How this be achieved?

This can be achieved by updating the existing SIP using [Update a Purchase Plan](#https://fintechprimitives.com/docs/api/#update-a-purchase-plan) -

##### Request
```json
{
  "id": "mfpp_dbabb25ba34c48329dbfbeff70c846f0",
  "amount": 10000
}
```

Upon updating the SIP with the new amount, all the remaining installments will be generated with amount as 10000.

#### Tina wants to change the installment date for an existing SIP from 7th of every month to 15th of every month. How can this be implemented? 

Changing the installment date of a SIP is not possible as RTA does not allow this as of now.
But this use case can be served if the user creates a purchase plan with `systematic` = false.
Then she can update the installment date of the plan using [Update a Purchase Plan](#https://fintechprimitives.com/docs/api/#update-a-purchase-plan) -

##### Request
```json
{
  "id": "mfpp_dbabb25ba34c48329dbfbeff70c846f0",
  "installment_day": 15
}
```

Upon updating the purchase plan with the new installment date, all the remaining installments will be generated by FP on the 15th of every month.

#### Mona invests 5,000 on a monthly SIP  on 17-March-2023. Her first installment to be deducted on 17-March-2023. Thereafter she should have the flexibility to choose her second installment date in March, Apr or May. 

For the above example, let's say the user wants to generate her next installment on 15th May.

Then this can be achieved using the following steps - <br>

**Step 1:** Create a purchase order of amount 5,000 on 17th March 2023.

##### Request
```json
{
  "mf_investment_account": "mfia_367a75826694614a539c0f82b196027",
  "scheme": "INF173K01FE6",
  "folio_number": "31171511",
  "amount": 5000
}
```
<br>
**Step 2:**  Create a purchase plan on the same day with activation date (`activate_after`) as 2023-05-01 and installment_day = 15

##### Request
```json
{
  "mf_investment_account": "mfia_367a75826694614a539c0f82b196027",
  "scheme": "INF173K01FE6",
  "frequency": "monthly",
  "folio_number": "31171511",
  "amount": 5000,
  "installment_day": 15,
  "number_of_installments": 7,
  "systematic": true,
  "purpose": "children_education",
  "generate_first_installment_now": false,
  "auto_generate_installments": true,
  "activate_after": "2023-05-01",
  "consent": {
    "email": "mona@gmail.com",
    "isd_code": "91",
    "mobile": "9008580644"
  }
}
```

### API References
1. Introduction to Transaction Plans
  - [FP Transaction Plans](#https://fintechprimitives.com/docs/api/#fp-transaction-plans)

2. Create a Transaction Plan
  - [Create a Purchase Plan](#https://fintechprimitives.com/docs/api/#create-a-purchase-plan)
  - [Create a Redemption Plan](#https://fintechprimitives.com/docs/api/#create-a-redemption-plan)
  - [Create a Switch Plan](#https://fintechprimitives.com/docs/api/#create-a-switch-plan)

3. Modify a Transaction Plan
  - [Update a Purchase Plan](#https://fintechprimitives.com/docs/api/#update-a-purchase-plan)
  - [Update a Redemption Plan](#https://fintechprimitives.com/docs/api/#update-a-redemption-plan)
  - [Update a Switch Plan](#https://fintechprimitives.com/docs/api/#update-a-switch-plan)

4. Cancel a Transaction Plan
  - [Cancel a Purchase Plan](#https://fintechprimitives.com/docs/api/#cancel-a-purchase-plan)
  - [Cancel a Redemption Plan](#https://fintechprimitives.com/docs/api/#cancel-a-redemption-plan)
  - [Cancel a Switch Plan](#https://fintechprimitives.com/docs/api/#cancel-a-switch-plan)

5. Pause a Transaction Plan
  - [Skip Installments](#https://fintechprimitives.com/docs/api/#skip-installments-via-skip-instructions)
