## Transaction Plan Workflow in RTA

This flow can be used to create a transaction plan in RTA.

### Workflow
<div>
  <img src="../../images/transaction-plans-workflow.png">
</div>


### Transaction Plan Lifecycle
1. User creates a transaction. The plan immediately becomes `active` upon plan creation. 
2. Once the plan becomes active, FP takes the responsibility of creating installments as per the `installment_day` and `frequency` of the plan. Refer Installment Generation Lifecycle section below to understand the flow of installments.
3. Once all the installment of the plan have been generated, the plan state changes to `completed`.

### Transaction Plan Modifications
1. After the plan is active, the user has the option to modify the plan as per his requirement -
   - If the plan is systematic (`systematic` = true), the user can update the plan amount only as of now.
   - If the plan is non-systematic (`systematic` = false), the user can update the plan amount, installment day and number of installments.
2. The user can opt for cancelling a plan. Upon plan cancellation, FP stops generating further installments of plan.
3. The user can also opt to pause a plan between a given timeframe. Upon pausing the plan, for all the installments that fall under the time frame, FP generates the installments and marks them as `cancelled`. 

### Installment Generation Lifecycle
1. On the day of the installment, FP generates the installment as a purchase order . The purchase order upon creation is in `pending` state. This order is `confirmed` for submission to RTA once the payment is done by the investor.
2. Once the order is submitted to the RTA gateway, the order state changes to `submitted`.
3. Once the order is successfully processed by the RTA and the reverse feed is generated and uploaded to FP, the order state changes to `successful`.

### Example Use Cases

##### Ajitha is an investor with Coinswitch, she is expecting a 40% increment in 2023 and wants to increase the Axis Emerging fund SIP from 5,000 to 10,000. How can Coinswitch achieve this ?

Coinswitch can update the existing SIP using [Update a Purchase Plan](#https://fintechprimitives.com/docs/api/#update-a-purchase-plan) -

Request
```json
{
  "id": "mfpp_dbabb25ba34c48329dbfbeff70c846f0",
  "amount": 10000
}
```

Upon updating the SIP with the new amount, all the remaining installments will be generated with amount as 10000.

#### Sravani is an investor with WrightResearch, she wants to change the installment date for an existing SIP Plan from 07th of every month to 15th of every month. How can WrightResearch implement this feature in their app. 

Changing the installment date of a SIP is not possible as RTA does not allow this as of now.
But this use case can be served if Sravani has created a purchase plan with `systematic` = false.
Then she can update the installment date of the plan using [Update a Purchase Plan](#https://fintechprimitives.com/docs/api/#update-a-purchase-plan) -

Request
```json
{
  "id": "mfpp_dbabb25ba34c48329dbfbeff70c846f0",
  "installment_day": 15
}
```

Upon updating the purchase plan with the new installment date, all the remaining installments will be generated by FP on the 15th of every month.

#### Shweta as an investor, invests with Multipl 5,000 monthly SIP  on 17-March-2023. Her first installment to be deducted on 17-March-2023. Thereafter she should have the flexibility to choose her second installment date in March , Apr or May. 


### API References
1. Create a Transaction Plan
  - [Create a Purchase Plan](#https://fintechprimitives.com/docs/api/#create-a-purchase-plan)
  - [Create a Redemption Plan](#https://fintechprimitives.com/docs/api/#create-a-redemption-plan)
  - [Create a Switch Plan](#https://fintechprimitives.com/docs/api/#create-a-switch-plan)

2. Update a Transaction Plan
  - [Update a Purchase Plan](#https://fintechprimitives.com/docs/api/#update-a-purchase-plan)
  - [Update a Redemption Plan](#https://fintechprimitives.com/docs/api/#update-a-redemption-plan)
  - [Update a Switch Plan](#https://fintechprimitives.com/docs/api/#update-a-switch-plan)

3. Cancel a Transaction Plan
  - [Cancel a Purchase Plan](#https://fintechprimitives.com/docs/api/#cancel-a-purchase-plan)
  - [Cancel a Redemption Plan](#https://fintechprimitives.com/docs/api/#cancel-a-redemption-plan)
  - [Cancel a Switch Plan](#https://fintechprimitives.com/docs/api/#cancel-a-switch-plan)

4. Pause a Transaction Plan
  - [Skip Installments](#https://fintechprimitives.com/docs/api/#skip-installments-via-skip-instructions)
